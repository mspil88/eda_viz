from flask import Flask, request, session, make_response, render_template
from flask_jsglue import JSGlue
import pandas as pd
import os


app = Flask(__name__)

jsglue = JSGlue()
jsglue.init_app(app)

@app.route("/")
def index():
    user = request
    sess = session
    print(sess)
    print(app.url_map)
    print(user)
    res = make_response('<h1> hi there </h1>')
    res.set_data('''{stuff: 5}''')
    res.status_code = 200
    return res

@app.route("/user/<id>")
def get_user(id):
    return f"<h1> Hi user: {id}"

@app.route("/overview")
def overview():
    #temp load
    data = pd.read_csv(os.path.join('/mnt/c/Users/matth/workspace/eda_viz/src/eda/data', "train.csv"))

    test_overview = {'overview': [{'rows': 891}, {'variables': 12}, {'missing': {'count': 866, 'proportion': 0.08099513655069211}}, {'missing_plot': {'x': ['Cabin', 'Age', 'Embarked', 'PassengerId', 'Survived', 'Pclass', 'Name', 'Sex', 'SibSp', 'Parch', 'Ticket', 'Fare'], 'y': [687, 177, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0]}}, {'duplicates': {'num_duplicates': 0, 'proportion_duplicated': 0.0}}, {'example': {'head': {'PassengerId': {0: 1, 1: 2, 2: 3, 3: 4, 4: 5}, 'Survived': {0: 0, 1: 1, 2: 1, 3: 1, 4: 0}, 'Pclass': {0: 3, 1: 1, 2: 3, 3: 1, 4: 3}, 'Name': {0: 'Braund, Mr. Owen Harris', 1: 'Cumings, Mrs. John Bradley (Florence Briggs Thayer)', 2: 'Heikkinen, Miss. Laina', 3: 'Futrelle, Mrs. Jacques Heath (Lily May Peel)', 4: 'Allen, Mr. William Henry'}, 'Sex': {0: 'male', 1: 'female', 2: 'female', 3: 'female', 4: 'male'}, 'Age': {0: 22.0, 1: 38.0, 2: 26.0, 3: 35.0, 4: 35.0}, 'SibSp': {0: 1, 1: 1, 2: 0, 3: 1, 4: 0}, 'Parch': {0: 0, 1: 0, 2: 0, 3: 0, 4: 0}, 'Ticket': {0: 'A/5 21171', 1: 'PC 17599', 2: 'STON/O2. 3101282', 3: '113803', 4: '373450'}, 'Fare': {0: 7.25, 1: 71.2833, 2: 7.925, 3: 53.1, 4: 8.05}, 'Cabin': {0: 'nan', 1: 'C85', 2: 'nan', 3: 'C123', 4: 'nan'}, 'Embarked': {0: 'S', 1: 'C', 2: 'S', 3: 'S', 4: 'S'}}, 'tail': {'PassengerId': {886: 887, 887: 888, 888: 889, 889: 890, 890: 891}, 'Survived': {886: 0, 887: 1, 888: 0, 889: 1, 890: 0}, 'Pclass': {886: 2, 887: 1, 888: 3, 889: 1, 890: 3}, 'Name': {886: 'Montvila, Rev. Juozas', 887: 'Graham, Miss. Margaret Edith', 888: 'Johnston, Miss. Catherine Helen "Carrie"', 889: 'Behr, Mr. Karl Howell', 890: 'Dooley, Mr. Patrick'}, 'Sex': {886: 'male', 887: 'female', 888: 'female', 889: 'male', 890: 'male'}, 'Age': {886: 27.0, 887: 19.0, 888: 'nan', 889: 26.0, 890: 32.0}, 'SibSp': {886: 0, 887: 0, 888: 1, 889: 0, 890: 0}, 'Parch': {886: 0, 887: 0, 888: 2, 889: 0, 890: 0}, 'Ticket': {886: '211536', 887: '112053', 888: 'W./C. 6607', 889: '111369', 890: '370376'}, 'Fare': {886: 13.0, 887: 30.0, 888: 23.45, 889: 30.0, 890: 7.75}, 'Cabin': {886: 'nan', 887: 'B42', 888: 'nan', 889: 'C148', 890: 'nan'}, 'Embarked': {886: 'S', 887: 'S', 888: 'S', 889: 'C', 890: 'Q'}}}}, {'data_types': {'PassengerId': {'original_dtype': 'int64', 'mapped_dtype': 'numeric'}, 'Survived': {'original_dtype': 'int64', 'mapped_dtype': 'categorical'}, 'Pclass': {'original_dtype': 'int64', 'mapped_dtype': 'categorical'}, 'Name': {'original_dtype': 'object', 'mapped_dtype': 'categorical'}, 'Sex': {'original_dtype': 'object', 'mapped_dtype': 'categorical'}, 'Age': {'original_dtype': 'float64', 'mapped_dtype': 'numeric'}, 'SibSp': {'original_dtype': 'int64', 'mapped_dtype': 'categorical'}, 'Parch': {'original_dtype': 'int64', 'mapped_dtype': 'categorical'}, 'Ticket': {'original_dtype': 'object', 'mapped_dtype': 'categorical'}, 'Fare': {'original_dtype': 'float64', 'mapped_dtype': 'numeric'}, 'Cabin': {'original_dtype': 'object', 'mapped_dtype': 'categorical'}, 'Embarked': {'original_dtype': 'object', 'mapped_dtype': 'categorical'}}}, {'mapped_type_count': {'numeric': 3, 'categorical': 9}}]}
    over = {'overview': [{'rows': 891},
  {'variables': 12},
  {'missing': {'count': 866, 'proportion': 0.08099513655069211}},
  {'missing_plot': {'x': ['Cabin',
     'Age',
     'Embarked',
     'PassengerId',
     'Survived',
     'Pclass',
     'Name',
     'Sex',
     'SibSp',
     'Parch',
     'Ticket',
     'Fare'],
    'y': [687, 177, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0]}},
  {'duplicates': {'count': 0, 'proportion': 0.0}},
  {'head': {'PassengerId': {0: 1, 1: 2, 2: 3, 3: 4, 4: 5},
    'Survived': {0: 0, 1: 1, 2: 1, 3: 1, 4: 0},
    'Pclass': {0: 3, 1: 1, 2: 3, 3: 1, 4: 3},
    'Name': {0: 'Braund, Mr. Owen Harris',
     1: 'Cumings, Mrs. John Bradley (Florence Briggs Thayer)',
     2: 'Heikkinen, Miss. Laina',
     3: 'Futrelle, Mrs. Jacques Heath (Lily May Peel)',
     4: 'Allen, Mr. William Henry'},
    'Sex': {0: 'male', 1: 'female', 2: 'female', 3: 'female', 4: 'male'},
    'Age': {0: 22.0, 1: 38.0, 2: 26.0, 3: 35.0, 4: 35.0},
    'SibSp': {0: 1, 1: 1, 2: 0, 3: 1, 4: 0},
    'Parch': {0: 0, 1: 0, 2: 0, 3: 0, 4: 0},
    'Ticket': {0: 'A/5 21171',
     1: 'PC 17599',
     2: 'STON/O2. 3101282',
     3: '113803',
     4: '373450'},
    'Fare': {0: 7.25, 1: 71.2833, 2: 7.925, 3: 53.1, 4: 8.05},
    'Cabin': {0: 'nan', 1: 'C85', 2: 'nan', 3: 'C123', 4: 'nan'},
    'Embarked': {0: 'S', 1: 'C', 2: 'S', 3: 'S', 4: 'S'}}},
  {'tail': {'PassengerId': {886: 887, 887: 888, 888: 889, 889: 890, 890: 891},
    'Survived': {886: 0, 887: 1, 888: 0, 889: 1, 890: 0},
    'Pclass': {886: 2, 887: 1, 888: 3, 889: 1, 890: 3},
    'Name': {886: 'Montvila, Rev. Juozas',
     887: 'Graham, Miss. Margaret Edith',
     888: 'Johnston, Miss. Catherine Helen Carrie',
     889: 'Behr, Mr. Karl Howell',
     890: 'Dooley, Mr. Patrick'},
    'Sex': {886: 'male',
     887: 'female',
     888: 'female',
     889: 'male',
     890: 'male'},
    'Age': {886: 27.0, 887: 19.0, 888: 'nan', 889: 26.0, 890: 32.0},
    'SibSp': {886: 0, 887: 0, 888: 1, 889: 0, 890: 0},
    'Parch': {886: 0, 887: 0, 888: 2, 889: 0, 890: 0},
    'Ticket': {886: '211536',
     887: '112053',
     888: 'W./C. 6607',
     889: '111369',
     890: '370376'},
    'Fare': {886: 13.0, 887: 30.0, 888: 23.45, 889: 30.0, 890: 7.75},
    'Cabin': {886: 'nan', 887: 'B42', 888: 'nan', 889: 'C148', 890: 'nan'},
    'Embarked': {886: 'S', 887: 'S', 888: 'S', 889: 'C', 890: 'Q'}}},
  {'data_types': {'PassengerId': {'original_dtype': 'int64',
     'mapped_dtype': 'numeric'},
    'Survived': {'original_dtype': 'int64', 'mapped_dtype': 'categorical'},
    'Pclass': {'original_dtype': 'int64', 'mapped_dtype': 'categorical'},
    'Name': {'original_dtype': 'object', 'mapped_dtype': 'categorical'},
    'Sex': {'original_dtype': 'object', 'mapped_dtype': 'categorical'},
    'Age': {'original_dtype': 'float64', 'mapped_dtype': 'numeric'},
    'SibSp': {'original_dtype': 'int64', 'mapped_dtype': 'categorical'},
    'Parch': {'original_dtype': 'int64', 'mapped_dtype': 'categorical'},
    'Ticket': {'original_dtype': 'object', 'mapped_dtype': 'categorical'},
    'Fare': {'original_dtype': 'float64', 'mapped_dtype': 'numeric'},
    'Cabin': {'original_dtype': 'object', 'mapped_dtype': 'categorical'},
    'Embarked': {'original_dtype': 'object', 'mapped_dtype': 'categorical'}}},
  {'mapped_type_count': {'numeric': 3, 'categorical': 9}}]}
    return render_template("overview.html", overview=over)

@app.route("/variables")
def variables():
    print("accessing variable route")
    obj = [{'PassengerId': [
   {'missing': {'count': 0, 'proportion': 0.0}},
   {'distinct': {'count': 891, 'proportion': 1.0}},
   {'zeros': {'count': 0, 'proportion': 0.0}},
   {'example': [878, 723, 562, 742, 210, 219, 643, 860, 635]},
   {'distribution': {'x': [1.0,
      90.0,
      179.0,
      268.0,
      357.0,
      446.0,
      535.0,
      624.0,
      713.0,
      802.0,
      891.0],
     'y': [89, 89, 89, 89, 89, 89, 89, 89, 89, 90]}},
   {'stats': {'mean': 446.0,
     'variance': 66231.0,
     'std': 257.3538420152301,
     'min': 1,
     'Q25': 223.5,
     'median': 446.0,
     'Q75': 668.5,
     'max': 891,
     'range': 890,
     'IQR': 445.0,
     'skew': 0.0,
     'kurtosis': -1.1999999999999997,
     'sum': 397386}},
    {'data_type': 'numeric'}]},
 {'Survived': [
   {'missing': {'count': 0, 'proportion': 0.0}},
   {'distinct': {'count': 2, 'proportion': 0.002244668911335578}},
   {'zeros': {'count': 549, 'proportion': 0.6161616161616161}},
   {'example': [0, 1, 0, 0, 1, 0, 0, 0, 0]},
   {'distribution': {'x': [0, 1], 'y': [549, 342]}},
   {'stats': {'mode': 0, 'entropy': 0.6659119735267652}},
     {'data_type': 'categorical'},
 ]},
 {'Pclass': [
   {'missing': {'count': 0, 'proportion': 0.0}},
   {'distinct': {'count': 3, 'proportion': 0.003367003367003367}},
   {'zeros': {'count': 0, 'proportion': 0.0}},
   {'example': [3, 3, 2, 3, 3, 3, 3, 2, 3]},
   {'distribution': {'x': [3, 1, 2], 'y': [491, 216, 184]}},
   {'stats': {'mode': 3, 'entropy': 0.9976616191577423}},
    {'data_type': 'categorical'},]},
 {'Name': [
   {'missing': {'count': 0, 'proportion': 0.0}},
   {'distinct': {'count': 891, 'proportion': 1.0}},
   {'zeros': {'count': 0, 'proportion': 0.0}},
   {'example': ['Arnold-Franchi, Mrs. Josef (Josefine Franchi)',
     'Spedden, Mrs. Frederic Oakley (Margaretta Corning Stone)',
     'Laroche, Miss. Simonne Marie Anne Andree',
     'Ekstrom, Mr. Johan',
     'Richards, Master. William Rowe',
     'Risien, Mr. Samuel Beard',
     'Canavan, Miss. Mary',
     'McCarthy, Mr. Timothy J',
     'Devaney, Miss. Margaret Delia']},
   {'distribution': {'x': ['Braund, Mr. Owen Harris',
      'Boulos, Mr. Hanna',
      'Frolicher-Stehli, Mr. Maxmillian',
      'Gilinski, Mr. Eliezer',
      'Murdlin, Mr. Joseph',
      'other'],
     'y': [1, 1, 1, 1, 1, 886]}},
   {'stats': {'mode': 'Abbing, Mr. Anthony', 'entropy': 6.792344427470811}},
           {'data_type': 'categorical'}]},
 {'Sex': [
   {'missing': {'count': 0, 'proportion': 0.0}},
   {'distinct': {'count': 2, 'proportion': 0.002244668911335578}},
   {'zeros': {'count': 0, 'proportion': 0.0}},
   {'example': ['female',
     'female',
     'male',
     'female',
     'male',
     'male',
     'female',
     'male',
     'female']},
   {'distribution': {'x': ['male', 'female'], 'y': [577, 314]}},
   {'stats': {'mode': 'male', 'entropy': 0.6489276088957644}},
    {'data_type': 'categorical'}]},
 {'Age': [
   {'missing': {'count': 177, 'proportion': 0.19865319865319866}},
   {'distinct': {'count': 88, 'proportion': 0.09876543209876543}},
   {'zeros': {'count': 0, 'proportion': 0.0}},
   {'example': [22.0, 19.0, 29.0, 4.0, 45.0, 18.0, 25.0, 34.0, 49.0]},
   {'distribution': {'x': [0.42,
      8.378,
      16.336000000000002,
      24.294000000000004,
      32.252,
      40.21,
      48.168000000000006,
      56.126000000000005,
      64.084,
      72.042,
      80.0],
     'y': [54, 46, 177, 169, 118, 70, 45, 24, 9, 2]}},
   {'stats': {'mean': 29.69911764705882,
     'variance': 211.0191247463081,
     'std': 14.526497332334044,
     'min': 0.42,
     'Q25': 20.125,
     'median': 28.0,
     'Q75': 38.0,
     'max': 80.0,
     'range': 79.58,
     'IQR': 17.875,
     'skew': 0.38910778230082704,
     'kurtosis': 0.17827415364210353,
     'sum': 21205.17}},
    {'data_type': 'numeric'}]},
 {'SibSp': [
   {'missing': {'count': 0, 'proportion': 0.0}},
   {'distinct': {'count': 7, 'proportion': 0.007856341189674524}},
   {'zeros': {'count': 608, 'proportion': 0.6823793490460157}},
   {'example': [0, 0, 0, 0, 1, 0, 0, 2, 0]},
   {'distribution': {'x': [0, 1, 2, 4, 3, 'other'],
     'y': [608, 209, 28, 18, 16, 12]}},
   {'stats': {'mode': 0, 'entropy': 0.9278185183972899}},
    {'data_type': 'categorical'}]},
 {'Parch': [
   {'missing': {'count': 0, 'proportion': 0.0}},
   {'distinct': {'count': 7, 'proportion': 0.007856341189674524}},
   {'zeros': {'count': 678, 'proportion': 0.7609427609427609}},
   {'example': [1, 0, 0, 0, 0, 0, 1, 1, 2]},
   {'distribution': {'x': [0, 1, 2, 5, 3, 'other'],
     'y': [678, 118, 80, 5, 5, 5]}},
   {'stats': {'mode': 0, 'entropy': 0.7821038727533371}},
    {'data_type': 'categorical'}]},
 {'Ticket': [
   {'missing': {'count': 0, 'proportion': 0.0}},
   {'distinct': {'count': 681, 'proportion': 0.7643097643097643}},
   {'zeros': {'count': 0, 'proportion': 0.0}},
   {'example': ['112059',
     '29104',
     '29105',
     'A/4 48871',
     'STON/O2. 3101271',
     '370365',
     'S.C./PARIS 2079',
     '347082',
     '2651']},
   {'distribution': {'x': ['347082',
      'CA. 2343',
      '1601',
      '3101295',
      'CA 2144',
      'other'],
     'y': [7, 7, 7, 6, 6, 858]}},
   {'stats': {'mode': '1601', 'entropy': 6.399828873350447}},
    {'data_type': 'categorical'}]},
 {'Fare': [
   {'missing': {'count': 0, 'proportion': 0.0}},
   {'distinct': {'count': 248, 'proportion': 0.2783389450056117}},
   {'zeros': {'count': 15, 'proportion': 0.016835016835016835}},
   {'example': [90.0,
     13.4167,
     7.8958,
     7.0542,
     31.275,
     8.05,
     90.0,
     7.8958,
     30.0]},
   {'distribution': {'x': [0.0,
      51.23292,
      102.46584,
      153.69876,
      204.93168,
      256.1646,
      307.39752,
      358.63044,
      409.86336,
      461.09628,
      512.3292],
     'y': [732, 106, 31, 2, 11, 6, 0, 0, 0, 3]}},
   {'stats': {'mean': 32.2042079685746,
     'variance': 2469.436845743117,
     'std': 49.693428597180905,
     'min': 0.0,
     'Q25': 7.9104,
     'median': 14.4542,
     'Q75': 31.0,
     'max': 512.3292,
     'range': 512.3292,
     'IQR': 23.0896,
     'skew': 4.787316519674893,
     'kurtosis': 33.39814088089868,
     'sum': 28693.9493}},
    {'data_type': 'numeric'}]},
 {'Cabin': [
   {'missing': {'count': 687, 'proportion': 0.7710437710437711}},
   {'distinct': {'count': 147, 'proportion': 0.16498316498316498}},
   {'zeros': {'count': 0, 'proportion': 0.0}},
   {'example': ['E36',
     'C54',
     'E49',
     'D20',
     'D56',
     'B50',
     'E25',
     'E12',
     'C92']},
   {'distribution': {'x': ['B96 B98',
      'G6',
      'C23 C25 C27',
      'C22 C26',
      'F33',
      'other'],
     'y': [4, 4, 4, 3, 3, 186]}},
   {'stats': {'mode': 'B96 B98', 'entropy': 4.897561648814725}},
    {'data_type': 'categorical'}]},
 {'Embarked': [
   {'missing': {'count': 2, 'proportion': 0.002244668911335578}},
   {'distinct': {'count': 3, 'proportion': 0.003367003367003367}},
   {'zeros': {'count': 0, 'proportion': 0.0}},
   {'example': ['S', 'S', 'S', 'S', 'S', 'S', 'S', 'Q', 'S']},
   {'distribution': {'x': ['S', 'C', 'Q'], 'y': [644, 168, 77]}},
   {'stats': {'mode': 'S', 'entropy': 0.7602918973432804}},
   {'data_type': 'categorical'}]}]

    keys = []
    for i in range(len(obj)):
        keys.append(list(obj[i].keys())[0])

    _map = {}

    for i in range(len(obj)):
        k = list(obj[i].keys())[0]
        if k != "overview":
            _map[k] = obj[i][k][6]["data_type"]



    return render_template("variables.html", keys=keys, obj=obj, _map=_map)